<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Sequência - Pedras</title>
<style>
  :root{
    --panel-w: 340px;
  }
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    background: #1a1a1a;
    color: white;
    font-family: Arial, sans-serif;
  }

  h1 { margin-bottom: 20px; }

  .circle {
    position: relative;
    width: 420px;
    height: 420px;
    border-radius: 50%;
  }

  .stone {
    position: absolute;
    width: 86px;
    height: 86px;
    background: #6b6b6b;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    cursor: pointer;
    transition: 0.25s;
    color: white;
    border: 2px solid #444;
    user-select: none;
  }
  .stone:hover{ transform: translateY(-2px); }

  .stone.correct { background: #4caf50; box-shadow: 0 0 20px #4caf50; }
  .stone.wrong   { background: #e53935; box-shadow: 0 0 20px #e53935; }

  /* Toggle sempre visível, sobre o painel */
  .config-toggle {
    position: fixed;
    top: 10px;
    right: 14px;
    cursor: pointer;
    font-size: 1.6rem;
    z-index: 1002;
    background: rgba(0,0,0,0.35);
    padding: 6px 10px;
    border-radius: 10px;
  }

  #config {
    position: fixed;
    top: 0;
    right: calc(var(--panel-w) * -1);
    width: var(--panel-w);
    height: 100%;
    background: #2c2c2c;
    padding: 18px 16px;
    box-shadow: -5px 0 12px rgba(0,0,0,0.55);
    transition: right 0.28s ease;
    overflow-y: auto;
    z-index: 1001;
  }
  #config.open { right: 0; }
  #config h2 { margin: 6px 0 12px; }
  #config .sec { margin: 14px 0; }
  #config code, #config .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 0.9rem; }
  .muted{ opacity: .8; font-size: .92rem; }
  .kv{ display: grid; grid-template-columns: 60px 1fr; gap: 8px 10px; align-items: center; }
  .list{ margin: 8px 0; padding-left: 16px; }
  .btn{ padding: 6px 10px; border: 1px solid #666; background: #1f1f1f; color: #fff; border-radius: 8px; cursor: pointer; }
  .btn:active{ transform: translateY(1px); }

</style>
</head>
<body>
  <h1>Jogo da Sequência</h1>
  <div class="circle" id="circle"></div>

  <div class="config-toggle" id="toggle">⚙️ Config</div>

  <div id="config">
    <h2>Configurações (somente leitura)</h2>
    <div class="muted">As definições vêm de <span class="mono">config.json</span>. Para editar para todos os jogadores, altere esse arquivo no projeto e publique novamente.</div>

    <div class="sec">
      <button class="btn" id="reloadCfg">Recarregar config</button>
    </div>

    <div class="sec">
      <strong>Ordem atual</strong>
      <div id="cfgOrder" class="mono">[não carregado]</div>
    </div>

    <div class="sec">
      <strong>Background</strong>
      <div id="cfgBg" class="mono">(nenhum)</div>
    </div>

    <div class="sec">
      <strong>Símbolos</strong>
      <ol id="cfgSymbols" class="list"></ol>
    </div>

    <div class="sec">
      <strong>Sons</strong>
      <ol id="cfgSounds" class="list"></ol>
      <div><strong>Som de erro:</strong> <span id="cfgErr" class="mono">(nenhum)</span></div>
    </div>

    <div class="sec muted">
      <div>Modo Admin via URL: adicione <code>?admin=1</code> para exibir/ocultar este painel.</div>
    </div>
  </div>

  <div id="message"></div>

<script>
  // ===== Flags =====
  const ADMIN = new URLSearchParams(location.search).has('admin');

  // ===== Layout das pedras =====
  const circle = document.getElementById('circle');
  const stoneShapes = [
    '20% 50% 40% 60% / 30% 50% 50% 70%',
    '40% 60% 20% 50% / 60% 30% 70% 40%',
    '50% 40% 60% 30% / 50% 70% 30% 50%',
    '30% 70% 50% 40% / 50% 30% 70% 50%',
    '60% 30% 50% 40% / 40% 60% 50% 30%',
    '50% 60% 30% 40% / 70% 50% 30% 50%',
    '30% 40% 70% 50% / 50% 30% 50% 70%',
    '40% 50% 30% 60% / 60% 40% 50% 30%'
  ];

  let correctOrder = [];
  let playerProgress = 0;
  let stoneImages = new Array(8).fill(null);
  let stoneSounds = new Array(8).fill(null);
  let errorSound = null;
  const stones = [];

  // Cria as 8 pedras em círculo (1 no topo, sentido horário)
  for (let i = 0; i < 8; i++) {
    const angle = (i / 8) * (2 * Math.PI);
    const x = 160 + 160 * Math.cos(angle - Math.PI/2);
    const y = 160 + 160 * Math.sin(angle - Math.PI/2);
    const btn = document.createElement('div');
    btn.className = 'stone';
    btn.style.left = x + 'px';
    btn.style.top  = y + 'px';
    btn.style.borderRadius = stoneShapes[i];
    btn.textContent = (i+1);
    btn.addEventListener('click', () => handleClick(i+1, btn));
    circle.appendChild(btn);
    stones.push(btn);
  }

  // ====== Config (somente leitura) ======
  const panel  = document.getElementById('config');
  const toggle = document.getElementById('toggle');
  const reloadBtn = document.getElementById('reloadCfg');
  const elOrder = document.getElementById('cfgOrder');
  const elBg    = document.getElementById('cfgBg');
  const elSyms  = document.getElementById('cfgSymbols');
  const elSnds  = document.getElementById('cfgSounds');
  const elErr   = document.getElementById('cfgErr');

  if (!ADMIN) {
    panel.classList.remove('open');
    toggle.style.display = 'none';
  } else {
    toggle.addEventListener('click', () => panel.classList.toggle('open'));
  }
  reloadBtn.addEventListener('click', () => loadConfig(true));

  // ====== Lê config.json e aplica ======
  async function loadConfig(force = false){
    try{
      const res = await fetch('config.json', { cache: force ? 'no-store' : 'default' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const cfg = await res.json();
      applyConfig(cfg);
      renderConfigPanel(cfg);
      setMessage('Configuração carregada com sucesso.');
    }catch(err){
      console.error(err);
      setMessage('Não foi possível carregar config.json. Usando padrões locais.');
    }
  }

  function applyConfig(cfg){
    // Ordem
    if (Array.isArray(cfg.order) && cfg.order.length === 8){
      correctOrder = cfg.order.slice();
      playerProgress = 0;
      clearStones();
    }
    // Background
    if (cfg.background){
      document.body.style.backgroundImage = `url(${cfg.background})`;
      document.body.style.backgroundSize = 'cover';
      document.body.style.backgroundPosition = 'center';
    } else {
      document.body.style.backgroundImage = '';
    }
    // Símbolos (imagens)
    if (Array.isArray(cfg.symbols)){
      for (let i=0;i<8;i++){
        stoneImages[i] = cfg.symbols[i] || null;
        if (stoneImages[i]){
          stones[i].textContent = '';
          stones[i].style.backgroundImage = `url(${stoneImages[i]})`;
          stones[i].style.backgroundSize = 'contain';
          stones[i].style.backgroundRepeat = 'no-repeat';
          stones[i].style.backgroundPosition = 'center';
        }else{
          stones[i].style.backgroundImage = 'none';
          stones[i].textContent = (i+1);
        }
      }
    }
    // Sons
    if (Array.isArray(cfg.sounds)){
      for (let i=0;i<8;i++){
        stoneSounds[i] = cfg.sounds[i] ? new Audio(cfg.sounds[i]) : null;
      }
    }
    errorSound = cfg.errorSound ? new Audio(cfg.errorSound) : null;
  }

  function renderConfigPanel(cfg){
    elOrder.textContent = Array.isArray(cfg.order) ? JSON.stringify(cfg.order) : '(não definido)';
    elBg.textContent = cfg.background || '(nenhum)';

    elSyms.innerHTML = '';
    const syms = cfg.symbols || [];
    for (let i=0;i<8;i++){
      const li = document.createElement('li');
      li.className = 'mono';
      li.textContent = syms[i] || '(padrão numérico)';
      elSyms.appendChild(li);
    }

    elSnds.innerHTML = '';
    const snds = cfg.sounds || [];
    for (let i=0;i<8;i++){
      const li = document.createElement('li');
      li.className = 'mono';
      li.textContent = snds[i] || '(sem som)';
      elSnds.appendChild(li);
    }
    elErr.textContent = cfg.errorSound || '(sem som)';
  }

  // ====== Jogo ======
  function handleClick(num, btn){
    if (!correctOrder.length) return; // sem config ainda
    if (num === correctOrder[playerProgress]){
      btn.classList.add('correct');
      if (stoneSounds[num-1]){
        try{ stoneSounds[num-1].currentTime = 0; stoneSounds[num-1].play(); }catch(e){}
      }
      playerProgress++;
      if (playerProgress === correctOrder.length){
        setMessage('Parabéns! Você completou a sequência.');
      }
    } else {
      flashWrong();
      if (errorSound){ try{ errorSound.currentTime = 0; errorSound.play(); }catch(e){} }
      setMessage('Errou! Reiniciando...');
      playerProgress = 0;
      setTimeout(clearStones, 900);
    }
  }

  function flashWrong(){
    stones.forEach(btn => {
      if (btn.classList.contains('correct')){
        btn.classList.remove('correct');
        btn.classList.add('wrong');
      }
    });
    setTimeout(()=> stones.forEach(b=> b.classList.remove('wrong')), 700);
  }

  function clearStones(){
    stones.forEach(btn => { btn.classList.remove('correct','wrong'); });
  }

  function setMessage(msg){
    const m = document.getElementById('message');
    m.textContent = msg || '';
  }

  // Inicializa
  loadConfig();
</script>
</body>
</html>
