<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Sequência - Pedras</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    background: #1a1a1a;
    color: white;
    font-family: Arial, sans-serif;
  }

  h1 {
    margin-bottom: 20px;
  }

  .circle {
    position: relative;
    width: 400px;
    height: 400px;
    border-radius: 50%;
  }

  .stone {
    position: absolute;
    width: 80px;
    height: 80px;
    background: gray;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    cursor: pointer;
    transition: 0.3s;
    color: white;
    border: 2px solid #444;
  }

  .stone.correct {
    background: #4caf50;
    box-shadow: 0 0 20px #4caf50;
  }

  .stone.wrong {
    background: #e53935;
    box-shadow: 0 0 20px #e53935;
  }

  .config-toggle {
    position: absolute;
    top: 10px;
    right: 20px;
    cursor: pointer;
    font-size: 1.5rem;
  }

  #config {
    position: fixed;
    top: 0;
    right: -320px;
    width: 300px;
    height: 100%;
    background: #333;
    padding: 20px;
    box-shadow: -5px 0 10px rgba(0,0,0,0.5);
    transition: right 0.3s;
    overflow-y: auto;
    z-index: 10;
  }

  #config.open {
    right: 0;
  }

  #config h2 {
    margin-top: 0;
  }

  .order-input {
    width: 100%;
    padding: 5px;
    margin-bottom: 10px;
  }

  .symbol-config {
    display: flex;
    align-items: center;
    margin: 5px 0;
  }

  .symbol-config label {
    width: 30px;
    margin-right: 10px;
  }

  #message {
    margin-top: 20px;
    font-size: 1.2rem;
  }

  /* Overlay de vídeo */
  .video-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .video-overlay video {
    max-width: 100%;
    max-height: 100%;
  }
</style>
</head>
<body>
  <h1 id="gameTitle">Jogo da Sequência</h1>
  <div class="circle" id="circle"></div>

  <div class="config-toggle" onclick="toggleConfig()">⚙️</div>

  <div id="config">
    <h2>Configurações</h2>
    <p>Defina a ordem correta (números separados por vírgula, ex: 1,3,5,2,...):</p>
    <input type="text" id="orderInput" class="order-input" placeholder="Ex: 1,2,3,4,5,6,7,8">
    <button onclick="setOrder()">Definir Ordem</button>
    <h3>Carregar símbolos</h3>
    <div id="symbolUploads"></div>
  </div>

  <div id="message"></div>

  <!-- Overlays de vídeo -->
  <div id="introOverlay" class="video-overlay" style="display:none;">
    <video id="introVideo" autoplay muted></video>
  </div>
  <div id="victoryOverlay" class="video-overlay" style="display:none;">
    <video id="victoryVideo"></video>
  </div>

<script>
  const circle = document.getElementById("circle");
  const stoneShapes = [
    "20% 50% 40% 60% / 30% 50% 50% 70%",
    "40% 60% 20% 50% / 60% 30% 70% 40%",
    "50% 40% 60% 30% / 50% 70% 30% 50%",
    "30% 70% 50% 40% / 50% 30% 70% 50%",
    "60% 30% 50% 40% / 40% 60% 50% 30%",
    "50% 60% 30% 40% / 70% 50% 30% 50%",
    "30% 40% 70% 50% / 50% 30% 50% 70%",
    "40% 50% 30% 60% / 60% 40% 50% 30%"
  ];

  let images = new Array(8).fill(null);
  let correctOrder = [];
  let playerProgress = 0;
  const stones = [];

  // Criar botões em círculo numerados
  for (let i = 0; i < 8; i++) {
    const angle = (i / 8) * (2 * Math.PI);
    const x = 150 * Math.cos(angle - Math.PI/2) + 160;
    const y = 150 * Math.sin(angle - Math.PI/2) + 160;

    const btn = document.createElement("div");
    btn.classList.add("stone");
    btn.style.left = x + "px";
    btn.style.top = y + "px";
    btn.style.borderRadius = stoneShapes[i];
    btn.textContent = i+1;

    btn.onclick = () => handleClick(i+1, btn);

    circle.appendChild(btn);
    stones.push(btn);
  }

  // uploads
  const uploadsContainer = document.getElementById("symbolUploads");
  for (let i = 0; i < 8; i++) {
    const div = document.createElement("div");
    div.classList.add("symbol-config");
    const label = document.createElement("label");
    label.textContent = i+1;
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/png";
    input.onchange = e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          images[i] = ev.target.result;
          stones[i].textContent = "";
          stones[i].style.backgroundImage = `url(${images[i]})`;
          stones[i].style.backgroundSize = "contain";
          stones[i].style.backgroundRepeat = "no-repeat";
          stones[i].style.backgroundPosition = "center";
        };
        reader.readAsDataURL(file);
      }
    };
    div.appendChild(label);
    div.appendChild(input);
    uploadsContainer.appendChild(div);
  }

  function setOrder() {
    const input = document.getElementById("orderInput").value.trim();
    if (!input) return;
    correctOrder = input.split(",").map(n => parseInt(n.trim()));
    playerProgress = 0;
    clearStones();
    document.getElementById("message").textContent = "Ordem definida. Jogo iniciado!";
  }

  function handleClick(num, btn) {
    if (correctOrder.length === 0) return;

    if (num === correctOrder[playerProgress]) {
      btn.classList.add("correct");
      playerProgress++;
      if (playerProgress === correctOrder.length) {
        document.getElementById("message").textContent = "Parabéns! Você completou a sequência.";
        playVictoryVideo();
      }
    } else {
      flashWrong();
      document.getElementById("message").textContent = "Errou! Reiniciando...";
      playerProgress = 0;
      setTimeout(clearStones, 1000);
    }
  }

  function flashWrong() {
    stones.forEach(btn => {
      if (btn.classList.contains("correct")) {
        btn.classList.remove("correct");
        btn.classList.add("wrong");
      }
    });
    setTimeout(() => {
      stones.forEach(btn => btn.classList.remove("wrong"));
    }, 800);
  }

  function clearStones() {
    stones.forEach(btn => {
      btn.classList.remove("correct");
      btn.classList.remove("wrong");
    });
  }

  function toggleConfig() {
    document.getElementById("config").classList.toggle("open");
  }

  // Funções de vídeo
  function playIntroVideo(src) {
    if (!src) return;
    const overlay = document.getElementById("introOverlay");
    const video = document.getElementById("introVideo");
    video.src = src;
    overlay.style.display = "flex";
    video.play();
    video.onended = () => {
      overlay.style.display = "none";
    };
  }

  function playVictoryVideo() {
    if (!window.victorySrc) return;
    const overlay = document.getElementById("victoryOverlay");
    const video = document.getElementById("victoryVideo");
    video.src = window.victorySrc;
    overlay.style.display = "flex";
    video.play();
    video.onended = () => {
      overlay.style.display = "none";
    };
  }

  // Carregar config.json
  fetch("config.json")
    .then(r => r.json())
    .then(cfg => {
      if (cfg.introVideo) {
        playIntroVideo(cfg.introVideo);
      }
      if (cfg.victoryVideo) {
        window.victorySrc = cfg.victoryVideo;
      }
    })
    .catch(err => console.warn("Sem config.json ou erro ao carregar:", err));
</script>
</body>
</html>
