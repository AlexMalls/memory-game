<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Sequência - Pedras</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    background: #1a1a1a;
    color: white;
    font-family: Arial, sans-serif;
  }

  h1 {
    margin-bottom: 20px;
  }

  .circle {
    position: relative;
    width: 400px;
    height: 400px;
    border-radius: 50%;
  }

  .stone {
    position: absolute;
    width: 80px;
    height: 80px;
    background: gray;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    cursor: pointer;
    transition: 0.3s;
    color: white;
    border: 2px solid #444;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }

  .stone.correct {
    background: #4caf50;
    box-shadow: 0 0 20px #4caf50;
  }

  .stone.wrong {
    background: #e53935;
    box-shadow: 0 0 20px #e53935;
  }

  #message {
    margin-top: 20px;
    font-size: 1.2rem;
  }

  /* Vídeos em tela cheia */
  #introVideo, #victoryVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: black;
    z-index: 1000;
    display: none;
  }
</style>
</head>
<body>
  <h1>Jogo da Sequência</h1>
  <div class="circle" id="circle"></div>

  <div id="message"></div>

  <!-- Vídeos -->
  <video id="introVideo" autoplay></video>
  <video id="victoryVideo"></video>

<script>
  const circle = document.getElementById("circle");
  const stones = [];
  let correctOrder = [];
  let playerProgress = 0;

  let sounds = [];
  let errorSound = null;
  let introVideo = null;
  let victoryVideo = null;

  // Criar botões em círculo numerados
  for (let i = 0; i < 8; i++) {
    const angle = (i / 8) * (2 * Math.PI);
    const x = 150 * Math.cos(angle - Math.PI/2) + 160;
    const y = 150 * Math.sin(angle - Math.PI/2) + 160;

    const btn = document.createElement("div");
    btn.classList.add("stone");
    btn.style.left = x + "px";
    btn.style.top = y + "px";
    btn.textContent = i+1;

    btn.onclick = () => handleClick(i+1, btn);

    circle.appendChild(btn);
    stones.push(btn);
  }

  // Função carregar configurações
  fetch("config.json")
    .then(res => res.json())
    .then(cfg => {
      // ordem correta
      correctOrder = cfg.order || [];

      // fundo
      if (cfg.background) {
        document.body.style.backgroundImage = `url(${cfg.background})`;
        document.body.style.backgroundSize = "cover";
      }

      // símbolos
      if (cfg.symbols) {
        cfg.symbols.forEach((src, i) => {
          if (stones[i]) {
            stones[i].textContent = "";
            stones[i].style.backgroundImage = `url(${src})`;
          }
        });
      }

      // sons
      if (cfg.sounds) {
        sounds = cfg.sounds.map(src => new Audio(src));
      }
      if (cfg.errorSound) {
        errorSound = new Audio(cfg.errorSound);
      }

      // vídeos
      if (cfg.introVideo) {
        introVideo = document.getElementById("introVideo");
        introVideo.src = cfg.introVideo;
        introVideo.style.display = "block";
        introVideo.onended = () => {
          introVideo.style.display = "none";
        };
      }
      if (cfg.victoryVideo) {
        victoryVideo = document.getElementById("victoryVideo");
        victoryVideo.src = cfg.victoryVideo;
        victoryVideo.onended = () => {
          victoryVideo.style.display = "none";
        };
      }

      document.getElementById("message").textContent = "Jogo pronto!";
    });

  function handleClick(num, btn) {
    if (correctOrder.length === 0) return;

    if (num === correctOrder[playerProgress]) {
      btn.classList.add("correct");
      if (sounds[num-1]) sounds[num-1].play();
      playerProgress++;
      if (playerProgress === correctOrder.length) {
        document.getElementById("message").textContent = "Parabéns! Você completou a sequência.";
        if (victoryVideo) {
          victoryVideo.style.display = "block";
          victoryVideo.play();
        }
      }
    } else {
      flashWrong();
      document.getElementById("message").textContent = "Errou! Reiniciando...";
      if (errorSound) errorSound.play();
      playerProgress = 0;
      setTimeout(clearStones, 1000);
    }
  }

  function flashWrong() {
    stones.forEach(btn => {
      if (btn.classList.contains("correct")) {
        btn.classList.remove("correct");
        btn.classList.add("wrong");
      }
    });
    setTimeout(() => {
      stones.forEach(btn => btn.classList.remove("wrong"));
    }, 800);
  }

  function clearStones() {
    stones.forEach(btn => {
      btn.classList.remove("correct");
      btn.classList.remove("wrong");
    });
  }
</script>
</body>
</html>
