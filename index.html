<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Sequência - Pedras</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    background: #1a1a1a;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  h1 { margin-bottom: 20px; }

  .circle {
    position: relative;
    width: 420px;
    height: 420px;
    border-radius: 50%;
  }

  .stone {
    position: absolute;
    width: 86px;
    height: 86px;
    background: #6b6b6b;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    cursor: pointer;
    transition: 0.25s;
    color: white;
    border: 2px solid #444;
    user-select: none;
  }
  .stone:hover{ transform: translateY(-2px); }

  .stone.correct { background: #4caf50; box-shadow: 0 0 20px #4caf50; }
  .stone.wrong   { background: #e53935; box-shadow: 0 0 20px #e53935; }

  /* Overlay preto para fade */
  #fadeOverlay {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:black;
    z-index:3000;
    opacity:1;
    transition: opacity 1s ease;
    pointer-events:none;
  }
</style>
</head>
<body>
  <h1>Jogo da Sequência</h1>
  <div class="circle" id="circle"></div>
  <div id="message"></div>
  <div id="fadeOverlay"></div>

<script>
  const circle = document.getElementById('circle');
  const stoneShapes = [
    '20% 50% 40% 60% / 30% 50% 50% 70%',
    '40% 60% 20% 50% / 60% 30% 70% 40%',
    '50% 40% 60% 30% / 50% 70% 30% 50%',
    '30% 70% 50% 40% / 50% 30% 70% 50%',
    '60% 30% 50% 40% / 40% 60% 50% 30%',
    '50% 60% 30% 40% / 70% 50% 30% 50%',
    '30% 40% 70% 50% / 50% 30% 50% 70%',
    '40% 50% 30% 60% / 60% 40% 50% 30%'
  ];

  let correctOrder = [];
  let playerProgress = 0;
  let stoneImages = new Array(8).fill(null);
  let stoneSounds = new Array(8).fill(null);
  let errorSound = null;
  const stones = [];

  // Cria as 8 pedras em círculo
  for (let i = 0; i < 8; i++) {
    const angle = (i / 8) * (2 * Math.PI);
    const x = 160 + 160 * Math.cos(angle - Math.PI/2);
    const y = 160 + 160 * Math.sin(angle - Math.PI/2);
    const btn = document.createElement('div');
    btn.className = 'stone';
    btn.style.left = x + 'px';
    btn.style.top  = y + 'px';
    btn.style.borderRadius = stoneShapes[i];
    btn.textContent = (i+1);
    btn.addEventListener('click', () => handleClick(i+1, btn));
    circle.appendChild(btn);
    stones.push(btn);
  }

  // ====== Lê config.json e aplica ======
  async function loadConfig(force = false){
    try{
      const res = await fetch('config.json', { cache: force ? 'no-store' : 'default' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const cfg = await res.json();
      applyConfig(cfg);
    }catch(err){
      console.error(err);
    }
  }

  function applyConfig(cfg){
    // Ordem
    if (Array.isArray(cfg.order) && cfg.order.length === 8){
      correctOrder = cfg.order.slice();
      playerProgress = 0;
      clearStones();
    }
    // Background
    if (cfg.background){
      document.body.style.backgroundImage = `url(${cfg.background})`;
      document.body.style.backgroundSize = 'cover';
      document.body.style.backgroundPosition = 'center';
    }
    // Símbolos (imagens)
    if (Array.isArray(cfg.symbols)){
      for (let i=0;i<8;i++){
        stoneImages[i] = cfg.symbols[i] || null;
        if (stoneImages[i]){
          stones[i].textContent = '';
          stones[i].style.backgroundImage = `url(${stoneImages[i]})`;
          stones[i].style.backgroundSize = 'contain';
          stones[i].style.backgroundRepeat = 'no-repeat';
          stones[i].style.backgroundPosition = 'center';
        }else{
          stones[i].style.backgroundImage = 'none';
          stones[i].textContent = (i+1);
        }
      }
    }
    // Sons
    if (Array.isArray(cfg.sounds)){
      for (let i=0;i<8;i++){
        stoneSounds[i] = cfg.sounds[i] ? new Audio(cfg.sounds[i]) : null;
      }
    }
    errorSound = cfg.errorSound ? new Audio(cfg.errorSound) : null;
  }

  // ====== Jogo ======
  function handleClick(num, btn){
    if (!correctOrder.length) return;
    if (num === correctOrder[playerProgress]){
      btn.classList.add('correct');
      if (stoneSounds[num-1]){
        try{ stoneSounds[num-1].currentTime = 0; stoneSounds[num-1].play(); }catch(e){}
      }
      playerProgress++;
      if (playerProgress === correctOrder.length){
        setMessage('Parabéns! Você completou a sequência.');
        fadeOut();
      }
    } else {
      flashWrong();
      if (errorSound){ try{ errorSound.currentTime = 0; errorSound.play(); }catch(e){} }
      setMessage('Errou! Reiniciando...');
      playerProgress = 0;
      setTimeout(clearStones, 900);
    }
  }

  function flashWrong(){
    stones.forEach(btn => {
      if (btn.classList.contains('correct')){
        btn.classList.remove('correct');
        btn.classList.add('wrong');
      }
    });
    setTimeout(()=> stones.forEach(b=> b.classList.remove('wrong')), 700);
  }

  function clearStones(){
    stones.forEach(btn => { btn.classList.remove('correct','wrong'); });
  }

  function setMessage(msg){
    const m = document.getElementById('message');
    m.textContent = msg || '';
  }

  // ===== Fade =====
  const fadeEl = document.getElementById('fadeOverlay');
  function fadeIn(){ fadeEl.style.opacity = 0; }
  function fadeOut(){
    fadeEl.style.opacity = 1;
    setTimeout(()=> alert('Jogo finalizado!'), 1200);
  }

  window.addEventListener('load', ()=>{
    fadeEl.style.transition = 'opacity 1s ease';
    fadeIn();
  });

  loadConfig();
</script>
</body>
</html>
